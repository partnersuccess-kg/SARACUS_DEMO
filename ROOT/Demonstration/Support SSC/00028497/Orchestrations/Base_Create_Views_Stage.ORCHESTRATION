{"job":{"components":{"69070":{"id":69070,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-464,"y":16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[69075],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"69071":{"id":69071,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-288,"y":32,"width":32,"height":32,"inputConnectorIDs":[69075],"outputSuccessConnectorIDs":[69072],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Build View Script"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nvScript = \"\"\"\nUSE ROLE SYSADMIN;\nUSE WAREHOUSE BUILD_WH;\nUSE DATABASE TEST_BRYAN;\nUSE SCHEMA STAGE_NUCLEUS_PERSONAL_LINES;\n\nCREATE OR REPLACE VIEW STAGE_NUCLEUS_PERSONAL_LINES.UNIT_FINAL\nAS\nselect\n      pol.POLICY_NUMBER         -- degenerate\n    , pol.POLICY_ID\n    , pol.POLICY_TYPE\n--    , pol.policy_version        -- degenerate - do not include in Unit?\n    , asset.ASSET_ID\n    , asset.ASSET_CREATED_DATE\n    , asset.STATUS      as ASSET_STATUS             -- renamed!\n    , asset.TYPE        as ASSET_TYPE               -- renamed!\n    , asset.ASSET_LINE  as LINE\n    , asset.SUBLINE\n    , asset.TOTAL_PREMIUM\n    , asset.UNIT_NUMBER\n    , asset.UNIT_NUMBER_MISTYPED\n    , asset.SORT_ORDER\n\n    -- Personal Excess\n    -- REVMOVE \"_ASSET\"?\n    , asset.EXCESSASSET_EXESSASSETTYPE          as EXCESS_ASSET_TYPE\n    , asset.EXCESSASSET_ADDRESS_ADDRESS         as EXCESS_ASSET_ADDRESS1\n    , asset.EXCESSASSET_ADDRESS_ADDRESS2        as EXCESS_ASSET_ADDRESS2\n    , asset.EXCESSASSET_ADDRESS_CITY            as EXCESS_ASSET_CITY\n    , asset.EXCESSASSET_ADDRESS_STATE           as EXCESS_ASSET_STATE\n    , asset.EXCESSASSET_ADDRESS_ZIP             as EXCESS_ASSET_ZIP\n    , asset.EXCESSASSET_ADDRESS_COUNTY          as EXCESS_ASSET_COUNTY\n    , asset.EXCESSASSET_ADDRESS_FIPS            as EXCESS_ASSET_FIPS_CODE\n    , asset.EXCESSASSET_ADDRESS_LATITUDE        as EXCESS_ASSET_LATITUDE\n    , asset.EXCESSASSET_ADDRESS_LONGITUDE       as EXCESS_ASSET_LONGITUDE\n    , asset.EXCESSASSET_ADDRESS_ATTRIBUTES      as EXCESS_ASSET_ADDRESS_ATTRIBUTES\n    , asset.EXCESSASSET_AUXILIARYENGINE         as EXCESS_ASSET_AUXILIARY_ENGINE\n    , asset.EXCESSASSET_CC                      as EXCESS_ASSET_DISPLACEMENT_CUBIC_CENTIMETERS  -- Cubic Centimeters?\n    , asset.EXCESSASSET_HP                      as EXCESS_ASSET_HORSEPOWER                      -- Horsepower?\n    , asset.EXCESSASSET_EXOTIC_PRESENT          as EXCESS_HAS_EXOTIC_ANIMAL\n    , asset.EXCESSASSET_EXOTIC_DETAILS          as EXCESS_EXOTIC_ANIMAL_DETAIL\n    , asset.EXCESSASSET_LIABILITYTYPE           as EXCESS_LIABILITY_TYPE\n    , asset.EXCESSASSET_LIABILITYLIMIT          as EXCESS_LIABILITY_LIMIT\n    , asset.EXCESSASSET_YEAR                    as EXCESS_ASSET_YEAR\n    , asset.EXCESSASSET_MAKE                    as EXCESS_ASSET_MAKE\n    , asset.EXCESSASSET_MODEL                   as EXCESS_ASSET_MODEL\n    , asset.EXCESSASSET_LENGTH                  as EXCESS_ASSET_LENGTH\n    , asset.EXCESSASSET_MAXSPEED                as EXCESS_ASSET_MAX_SPEED\n    , asset.EXCESSASSET_MOTORTYPE               as EXCESS_ASSET_MOTOR_TYPE\n    , asset.EXCESSASSET_NUMBEROFFAMILIES        as EXCESS_NUMBER_OF_FAMILIES\n    , asset.EXCESSASSET_OCCUPANCYSTATUS         as EXCESS_OCCUPANCY_STATUS\n    , asset.EXCESSASSET_RENTED                  as EXCESS_ASSET_IS_RENTED       -- TRUE/FALSE\n    , asset.EXCESSASSET_SWIMMINGPOOL_PRESENT    as EXCESS_HAS_SWIMMING_POOL\n    , asset.EXCESSASSET_SWIMMINGPOOL_FENCE      as EXCESS_HAS_SWIMMING_POOL_FENCE\n    , asset.EXCESSASSET_TRAMPOLINE_PRESENT      as EXCESS_HAS_TRAMPOLINE\n    , asset.EXCESSASSET_TRAMPOLINE_FENCE        as EXCESS_HAS_TRAMPOLINE_FENCE\n    , asset.EXCESSASSET_CURRENTCARRIER          as EXCESS_CURRENT_CARRIER\n    , asset.EXCESSASSET_POLICYNUMBER            as EXCESS_POLICY_NUMBER\n    , asset.EXCESSASSET_VERSION                 as EXCESS_ASSET_VERSION\n\n    -- Home\n    , asset.PROPERTY_ADDRESS_ID                 -- Is this the same as POLICY_ADDRESSES.Physical_Address?  Do we need to join?\n    , asset.PROPERTY_ADDRESS_ADDRESS                                        as PROPERTY_ADDRESS\n    , asset.PROPERTY_ADDRESS_CITY                                           as PROPERTY_CITY\n    , asset.PROPERTY_ADDRESS_STATE                                          as PROPERTY_STATE\n    , asset.PROPERTY_ADDRESS_ZIP                                            as PROPERTY_ZIP\n    , asset.PROPERTY_ADDRESS_COUNTY                                         as PROPERTY_COUNTY\n    , asset.PROPERTY_ADDRESS_FIPS                                           as PROPERTY_FIPS_CODE\n    , asset.PROPERTY_ADDRESS_LATITUDE                                       as PROPERTY_LATITUDE\n    , asset.PROPERTY_ADDRESS_LONGITUDE                                      as PROPERTY_LONGITUDE\n    , asset.PROPERTY_ADDRESS_ATTRIBUTES\n    , asset.PROPERTY_PERSONALLINES_ADDHOM012                                as PROPERTY_ADD_HOM012_THEFT_OF_BUILDING_MATERIALS\n    , asset.PROPERTY_PERSONALLINES_ANIMALS_DOGSOFBREEDS                     as PROPERTY_DOG_BREED\n    , asset.PROPERTY_PERSONALLINES_ANIMALS_DOGSWITHBITEHISTORY              as PROPERTY_DOG_BITE_HISTORY\n    , asset.PROPERTY_PERSONALLINES_ANIMALS_EXOTIC_PRESENT                   as PROPERTY_HAS_EXOTIC_ANIMAL\n    , asset.PROPERTY_PERSONALLINES_ANIMALS_EXOTIC_DETAILS                   as PROPERTY_EXOTIC_ANIMAL_DETAIL\n    , asset.PROPERTY_PERSONALLINES_ANIMALS_HORSES_PRESENT                   as PROPERTY_HAS_HORSE\n--    , IFNULL(asset.PROPERTY_PERSONALLINES_ANIMALS_HORSES_COUNT, 0)        as PROPERTY_HORSE_COUNT                 -- Don't think we want to do this here...\n    , asset.PROPERTY_PERSONALLINES_ANIMALS_HORSES_COUNT                     as PROPERTY_HORSE_COUNT\n    , asset.PROPERTY_PERSONALLINES_ANIMALS_PRESENT                          as PROPERTY_HAS_ANIMAL\n    , asset.PROPERTY_PERSONALLINES_BUSINESSONPREMISES                       as PROPERTY_HAS_BUSINESS_ON_PREMISES\n    , asset.PROPERTY_PERSONALLINES_CLUEREQUESTED                            as PROPERTY_CLUE_REPORT_REQUESTED\n    , asset.PROPERTY_PERSONALLINES_CONSTRUCTION_LOGS_HANDHEWN               as PROPERTY_HAND_HEWN_LOGS              -- Y/N\n    , asset.PROPERTY_PERSONALLINES_CONSTRUCTION_LOGS_UNIFORMSIZE            as PROPERTY_UNIFORM_SIZE_LOGS\n    , asset.PROPERTY_PERSONALLINES_CONSTRUCTION_TYPE                        as PROPERTY_CONSTRUCTION_TYPE_CODE\n    , asset.PROPERTY_PERSONALLINES_DWELLINGCONVERTED                        as PROPERTY_DWELLING_CONVERTED\n    , asset.PROPERTY_PERSONALLINES_EXTPAINTRENOTYPE                         as PROPERTY_EXTERIOR_PAINT_TYPE_CODE\n    , asset.PROPERTY_PERSONALLINES_EXTPAINTRENOYEAR                         as PROPERTY_EXTERIOR_PAINT_YEAR\n    , asset.PROPERTY_PERSONALLINES_EXTERIORWALLFINISH                       as PROPERTY_EXTERIOR_WALL_FINISH_CODE\n    , asset.PROPERTY_PERSONALLINES_FARFROMPRIMARY                           as PROPERTY_FAR_FROM_PRIMARY            -- ?\n    , asset.PROPERTY_PERSONALLINES_FOUNDATIONTYPE                           as PROPERTY_FOUNDATION_TYPE_CODE\n    , asset.PROPERTY_PERSONALLINES_GARAGE_PRESENT                           as PROPERTY_HAS_GARAGE\n    , asset.PROPERTY_PERSONALLINES_GARAGE_NUMBEROFCARS                      as PROPERTY_GARAGE_NUMBER_OF_CARS       -- ? PROPERTY_GARAGE_CAR_COUNT\n    , asset.PROPERTY_PERSONALLINES_GARAGE_STYLE                             as PROPERTY_GARAGE_STYLE_CODE\n    , asset.PROPERTY_PERSONALLINES_GARAGE_TYPE                              as PROPERTY_GARAGE_TYPE_CODE\n    , asset.PROPERTY_PERSONALLINES_HEATING_PRIMARY                          as PROPERTY_PRIMARY_HEAT_CODE\n    , asset.PROPERTY_PERSONALLINES_HEATING_WOODSTOVE_PRESENT                as PROPERTY_HAS_WOOD_STOVE\n    , asset.PROPERTY_PERSONALLINES_HEATING_WOODSTOVE_INGARAGE               as PROPERTY_WOOD_STOVE_IN_GARAGE\n    , asset.PROPERTY_PERSONALLINES_HOMECONSTRUCTION_CONTRACTORLICENSED      as PROPERTY_IS_CONTRACTOR_LICENSED\n    , asset.PROPERTY_PERSONALLINES_HOMECONSTRUCTION_CONTRACTORLICENSE       as PROPERTY_LICENSE_NUMBER\n    , asset.PROPERTY_PERSONALLINES_HOMECONSTRUCTION_CONTRACTORNAME          as PROPERTY_CONTRACTOR_NAME\n    , asset.PROPERTY_PERSONALLINES_HOMECONSTRUCTION_COURSEOFCONSTRUCTION    as PROPERTY_HAS_COURSE_OF_CONSTRUCTION\n    , asset.PROPERTY_PERSONALLINES_HOMECONSTRUCTION_STARTDATE               as PROPERTY_CONSTRUCTION_START_DATE\n    , asset.PROPERTY_PERSONALLINES_HOMECONSTRUCTION_ESTENDDATE              as PROPERTY_ESTIMATED_END_DATE\n    , asset.PROPERTY_PERSONALLINES_INCITYLIMITS                             as PROPERTY_IN_CITY_LIMITS\n    , asset.PROPERTY_PERSONALLINES_NUMFAMILIES                              as PROPERTY_NUMBER_OF_FAMILIES\n    , asset.PROPERTY_PERSONALLINES_OCCUPANCYSTATUS                          as PROPERTY_OCCUPANCY_STATUS_CODE\n\n    , asset.PROPERTY_PERSONALLINES_PERILPREMIUMS_ALLPERILS                  as PROPERTY_PERIL_PREMIUM_ALL_PERIL\n    , asset.PROPERTY_PERSONALLINES_PERILPREMIUMS_FIRE                       as PROPERTY_PERIL_PREMIUM_FIRE\n    , asset.PROPERTY_PERSONALLINES_PERILPREMIUMS_LIABILITY                  as PROPERTY_PERIL_PREMIUM_LIABILITY\n    , asset.PROPERTY_PERSONALLINES_PERILPREMIUMS_OTHERPROPERTY              as PROPERTY_PERIL_PREMIUM_OTHER_PROPERTY\n    , asset.PROPERTY_PERSONALLINES_PERILPREMIUMS_THEFT                      as PROPERTY_PERIL_PREMIUM_THEFT\n    , asset.PROPERTY_PERSONALLINES_PERILPREMIUMS_WATER                      as PROPERTY_PERIL_PREMIUM_WATER\n    , asset.PROPERTY_PERSONALLINES_PERILPREMIUMS_WIND                       as PROPERTY_PERIL_PREMIUM_WIND\n\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONCLASS_CLASS                    as PROPERTY_PROTECTION_CLASS_CODE\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONCLASS_DISTANCEFIREHYDRANT      as PROPERTY_DISTANCE_TO_FIRE_HYDRANT\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONCLASS_DISTANCEFIRESTATION      as PROPERTY_DISTANCE_TO_FIRE_STATION\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONCLASS_FIREDISTRICTNAME         as PROPERTY_FIRE_DISTRICT_NAME\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONCLASS_FIREDISTRICTSUBSCRIPTION as PROPERTY_FIRE_DISTRICT_SUBSCRIPTION\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONCLASS_INITIAL                  as PROPERTY_PROTECTION_CLASS_INITIAL\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONCLASS_LASTREQUESTDATE          as PROPERTY_PROTECTION_CLASS_LAST_REQUEST_DATE\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONCLASS_OVERRIDE                 as PROPERTY_PROTECTION_CLASS_OVERRIDE\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONDEVICE_BURGLAR                 as PROPERTY_PROTECTION_DEVICE_BURGLAR_CODE\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONDEVICE_FIRE                    as PROPERTY_PROTECTION_DEVICE_FIRE\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONDEVICE_SMOKE                   as PROPERTY_PROTECTION_DEVICE_SMOKE\n    , asset.PROPERTY_PERSONALLINES_PROTECTIONDEVICE_SPRINKLER               as PROPERTY_PROTECTION_DEVICE_SPRINKLER\n    , asset.PROPERTY_PERSONALLINES_RESIDENCE_TYPE                           as PROPERTY_RESIDENCE_TYPE_CODE\n\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_HAIL_DATE                     as PROPERTY_RISK_SCORE_HAIL_DATE\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_HAIL_ID                       as PROPERTY_RISK_SCORE_HAIL_CODE        -- rename?\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_HAIL_SCORE                    as PROPERTY_RISK_SCORE_HAIL_SCORE\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_HAILDAMAGE_DATE               as PROPERTY_RISK_SCORE_HAIL_DAMAGE_DATE\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_HAILDAMAGE_ID                 as PROPERTY_RISK_SCORE_HAIL_DAMAGE_CODE -- rename?\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_HAILDAMAGE_SCORE              as PROPERTY_RISK_SCORE_HAIL_DAMAGE_SCORE\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_WILDFIRE_DATE                 as PROPERTY_RISK_SCORE_WILDFIRE_DATE\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_WILDFIRE_ID                   as PROPERTY_RISK_SCORE_WILDFIRE_CODE\n    , asset.PROPERTY_PERSONALLINES_RISKSCORES_WILDFIRE_SCORE                as PROPERTY_RISK_SCORE_WILDFIRE_SCORE\n    , asset.PROPERTY_PERSONALLINES_ROOF_AGE                                 as PROPERTY_ROOF_AGE\n    , asset.PROPERTY_PERSONALLINES_ROOF_TYPE                                as PROPERTY_ROOF_TYPE_CODE\n    , asset.PROPERTY_PERSONALLINES_SQFT                                     as PROPERTY_AREA_SQUARE_FEET\n    , asset.PROPERTY_PERSONALLINES_STORIES                                  as PROPERTY_NUMBER_OF_STORIES\n    , asset.PROPERTY_PERSONALLINES_STYLE                                    as PROPERTY_STRUCTURE_STYLE\n    , asset.PROPERTY_PERSONALLINES_SWIMMINGPOOL_PRESENT                     as PROPERTY_HAS_SWIMMING_POOL\n    , asset.PROPERTY_PERSONALLINES_SWIMMINGPOOL_FENCE                       as PROPERTY_HAS_SWIMMING_POOL_FENCE\n    , asset.PROPERTY_PERSONALLINES_TERRITORIES_FIRE                         as PROPERTY_TERRITORY_FIRE\n    , asset.PROPERTY_PERSONALLINES_TERRITORIES_LIABILITY                    as PROPERTY_TERRITORY_LIABILITY\n    , asset.PROPERTY_PERSONALLINES_TERRITORIES_OTHERPROPERTY                as PROPERTY_TERRITORY_OTHER_PROPERTY\n    , asset.PROPERTY_PERSONALLINES_TERRITORIES_THEFT                        as PROPERTY_TERRITORY_THEFT\n    , asset.PROPERTY_PERSONALLINES_TERRITORIES_WATER                        as PROPERTY_TERRITORY_WATER\n    , asset.PROPERTY_PERSONALLINES_TERRITORIES_WIND                         as PROPERTY_TERRITORY_WIND\n    , asset.PROPERTY_PERSONALLINES_TERRITORY                                as PROPERTY_TERRITORY\n    , asset.PROPERTY_PERSONALLINES_VALUE360LOOKUP_RCV                       as PROPERTY_360LOOKUP_RCV\n    , asset.PROPERTY_PERSONALLINES_VALUE360LOOKUP_RCV_MESSAGE               as PROPERTY_360LOOKUP_RCV_MESSAGE\n    , asset.PROPERTY_PERSONALLINES_VALUE360LOOKUP_VALUATIONID               as PROPERTY_360LOOKUP_VALUATION_ID\n    , asset.PROPERTY_PERSONALLINES_WIRING_CIRCUITBREAKER                    as PROPERTY_HAS_CIRCUIT_BREAKER\n    , asset.PROPERTY_PERSONALLINES_WIRING_CIRCUITBREAKERS                   as PROPERTY_HAS_CIRCUIT_BREAKERS\n    , asset.PROPERTY_PERSONALLINES_WIRING_KNOBANDTUBE                       as PROPERTY_HAS_KNOB_AND_TUBE_WIRING\n    , asset.PROPERTY_PERSONALLINES_YEARBUILT                                as PROPERTY_YEAR_BUILT\n    , asset.PROPERTY_VERSION\n\n    -- Auto\n    , asset.VEHICLE_YEAR\n    , asset.VEHICLE_MAKE\n    , asset.VEHICLE_MODEL\n    , asset.VEHICLE_VIN\n    , asset.VEHICLE_HAVE_VIN                                                                                        -- Y/N\n    , asset.VEHICLE_TYPE                                                    as VEHICLE_TYPE_CODE\n    , asset.VEHICLE_PERSONALLINES_PURCHASEDATE                              as VEHICLE_PURCHASE_DATE\n    , asset.VEHICLE_PERSONALLINES_COSTNEW                                   as VEHICLE_COST_NEW\n    , asset.VEHICLE_PERSONALLINES_OWNERSHIP                                 as VEHICLE_OWNERSHIP_STATUS\n    , asset.VEHICLE_PERSONALLINES_ANNUALMILES                               as VECHILE_ANNUAL_MILEAGE\n    , asset.VEHICLE_PERSONALLINES_USAGE                                     as VEHICLE_USAGE_CODE\n    , asset.VEHICLE_PERSONALLINES_COMPONLY                                  as VEHICLE_HAS_COMPREHENSIVE_ONLY       -- Has only Comprehensive coverage.\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALSYMBOL                          as VEHICLE_ADDITIONAL_SYMBOL\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_ANTILOCKBRAKES       as VEHICLE_ANTILOCK_BRAKES_CODE\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_BODYTYPE             as VEHICLE_BODY_TYPE_CODE             \n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_CYLINDERS            as VEHICLE_NUMBER_OF_CYCLINDERS         -- ? VEHICLE_CYCLINDER_COUNT\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_DRIVEWHEELS          as VEHICLE_NUMBER_OF_DRIVE_WHEELS\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_ENGINEDISPLACEMENT   as VEHICLE_ENGINE_DISPLACEMENT          -- Units?  cu. in./ cc ?\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_LASTVINCHECKDATE     as VEHICLE_LAST_VIN_CHECK_DATE\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_LENGTH               as VEHICLE_LENGTH                       -- Units?\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_MOTORCYCLETYPE       as VEHICLE_MOTORCYCLE_TYPE_CODE\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_PASSIVEBELTS         as VEHICLE_NUMBER_OF_PASSIVE_SEATBELTS\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_PREFORMANCE          as VEHICLE_PERFORMANCE_CODE\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_SUBTYPE              as VEHICLE_SUBTYPE_CODE                 -- not populated\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_VEHICLECLASSDESC     as VEHICLE_CLASS_DESC_CODE              -- code or desc?\n    , asset.VEHICLE_PERSONALLINES_ADDITIONALVINDETAILS_VINTSTATUS           as VEHICLE_VINTAGE_STATUS_CODE\n    , asset.VEHICLE_PERSONALLINES_ANTITHEFTDEVICE                           as VEHICLE_ANTITHEFT_DEVICE_CODE\n    , asset.VEHICLE_CALCULATEDFIELDS_BIPDSYMBOL                             as VEHICLE_CALCULATED_FIELDS_BI_PD_SYMBOL\n    , asset.VEHICLE_CALCULATEDFIELDS_COLLISIONSYMBOL                        as VEHICLE_CALCULATED_FIELDS_COLLISION_SYMBOL\n    , asset.VEHICLE_CALCULATEDFIELDS_COMPREHENSIVESYMBOL                    as VEHICLE_CALCULATED_FIELDS_COMPREHENSIVE_SYMBOL\n    , asset.VEHICLE_CALCULATEDFIELDS_PIPMEDSYMBOL                           as VEHICLE_CALCULATED_FIELDS_PIP_MED_SYMBOL\n    , addr.ADDRESS                      as GARAGE_ADDRESS\n    , addr.CITY                         as GARAGE_CITY\n    , addr.STATE                        as GARAGE_STATE\n    , addr.ZIP                          as GARAGE_ZIP\n    , addr.LATITUDE                     as GARAGE_LATITUDE\n    , addr.LONGITUDE                    as GARAGE_LONGITUDE\n    , addr.COUNTY                       as GARAGE_COUNTY\n    , addr.FIPS                         as GARAGE_FIPS_CODE\n    , addr.TERRITORY                    as GARAGE_TERRITORY_CODE\n--  , addr.GARAGE_LOCATION              -- needed only for dev/debugging\n    , asset.VEHICLE_GARAGELOCATION      as VEHICLE_GARAGE_LOCATION_ID\n    , asset.VEHICLE_VERSION\n\n    , asset.VERSION                     as CODE_VERSION\n    , asset.FILENAME                    as FILE_NAME\n    , asset.FILE_DATETIME\n    , asset.UPDATE_TOKEN\n\nfrom EXTRACT_NUCLEUS_PERSONAL_LINES.POLICIES pol\nleft join EXTRACT_NUCLEUS_PERSONAL_LINES.ASSETS asset\n    on pol.POLICY_ID = asset.POLICY_ID\nleft join EXTRACT_NUCLEUS_PERSONAL_LINES.POLICY_ADDRESSES addr\n    on pol.POLICY_ID = addr.POLICY_ID\n    and pol.POLICY_VERSION = addr.POLICY_VERSION\n    and asset.VEHICLE_GARAGELOCATION = addr.ADDRESS_ID\n    and addr.GARAGE_LOCATION = TRUE                         -- is this desired?\nwhere pol.SOURCE_SYSTEM = 'Nucleus'\n--    and pol.POLICY_TYPE = 'packageExcess'\n--   and pol.POLICY_TYPE = 'packageHome'\n--    and pol.POLICY_TYPE = 'packageAuto'\n--    and pol.Policy_Number = 'XB60004485'  -- Excess\n--    and pol.Policy_Number = '?'  -- Home\n--    and pol.Policy_Number = 'AB30009120'  -- Auto\n;\n\n\n-------------------------- BEGIN COVERAGE FINAL ------------------------------------------------------------------------------\nCREATE or REPLACE VIEW STAGE_NUCLEUS_PERSONAL_LINES.NUCLEUS_COVERAGE_FINAL\n    COMMENT = '05Feb20\tJim Nichols\tImplemented new Business Key first Column Order. Only runs on build DEV_INSURANCE_2020_02_04_12_25_01 or later.'\nas\nselect p.POLICY_NUMBER, pc.POLICY_VERSION, cast(0 as Integer) as UNIT_NUMBER\n, INSURANCE_COVERAGE_CODE, QUOTE_COVERAGE_CODE, QUOTE_COVERAGE_DESCRIPTION, '??.?' as ANNUAL_STATEMENT_LINE_CODE\n, FORM_NUMBER, cast(ACCOUNTING_DATE as date) as ACCOUNTING_DATE\n, IFNULL(TERM_PREMIUM_AMOUNT, RATE) as TERM_PREMIUM_AMOUNT\n, IFNULL(TERM_PREMIUM_AMOUNT_CHANGE, RATE_CHANGE) AS TERM_PREMIUM_AMOUNT_CHANGE\n, WRITTEN_PREMIUM, WRITTEN_PREMIUM_CHANGE\n, COMMISSION_AMOUNT, COMMISSION_AMOUNT_CHANGE\n, EARNED_PREMIUM, VALUE_TYPE, VALUE\n, DRIVER_ID, DRIVER_ID_PARENT_ID\n, pc.POLICY_ID, NULL as ASSET_ID, pc.COVERAGE_ID\nfrom EXTRACT_NUCLEUS_PERSONAL_LINES.POLICY_COVERAGES pc\njoin EXTRACT_NUCLEUS_PERSONAL_LINES.POLICIES p\n    on pc.POLICY_ID = p.POLICY_ID\nunion all\nselect p.POLICY_NUMBER, p.POLICY_VERSION, cast(coalesce(UNIT_NUMBER, UNIT_NUMBER_MISTYPED, a.SORT_ORDER) as Integer) as UNIT_NUMBER\n, COVERAGES_COV_CODE as INSURANCE_COVERAGE_CODE\n, COVERAGES_CODE as QUOTE_COVERAGE_CODE, COVERAGES_COVERAGE_DESCRIPTION as QUOTE_COVERAGE_DESCRIPTION, '??.?' as ANNUAL_STATEMENT_LINE_CODE\n, COVERAGES_FORM_NUMBER as FORM_NUMBER, cast(COVERAGES_ACCOUNTING_DATE as date) as ACCOUNTING_DATE\n, COVERAGES_TERM_PREMIUM as TERM_PREMIUM_AMOUNT, COVERAGES_TERM_PREMIUM_CHANGE as TERM_PREMIUM_AMOUNT_CHANGE\n, COVERAGES_WRITTEN_PREMIUM as WRITTEN_PREMIUM, COVERAGES_WRITTEN_PREMIUM_CHANGE as WRITTEN_PREMIUM_CHANGE\n, COVERAGES_COMMISSION as COMMISSION_AMOUNT, COVERAGES_COMMISSION_CHANGE as COMMISSION_AMOUNT_CHANGE\n, COVERAGES_EARNED_PREMIUM as EARNED_PREMIUM, COVERAGES_VALUE_TYPE as VALUE_TYPE, COVERAGES_VALUE as VALUE\n, NULL AS DRIVER_ID, NULL AS DRIVER_ID_PARENT_ID\n, ac.POLICY_ID, a.ASSET_ID, COVERAGES_ID as COVERAGE_ID\nfrom EXTRACT_NUCLEUS_PERSONAL_LINES.ASSET_COVERAGES ac\njoin EXTRACT_NUCLEUS_PERSONAL_LINES.ASSETS a\n    on ac.ASSET_ID = a.ASSET_ID\n        and ac.POLICY_ID = a.POLICY_ID\njoin EXTRACT_NUCLEUS_PERSONAL_LINES.POLICIES p\n    on ac.POLICY_ID = p.POLICY_ID;\n\n/* -- TEST QUERY\nselect *\nfrom STAGE_NUCLEUS_PERSONAL_LINES.NUCLEUS_COVERAGE_FINAL\norder by POLICY_ID, UNIT_NUMBER, INSURANCE_COVERAGE_CODE;\n--*/\n\n/* -- SOURCE KEY VALIDATION QUERY\nselect POLICY_NUMBER, POLICY_VERSION, POLICY_ID, ASSET_ID, COVERAGE_ID, COUNT(*) as RowCount\nfrom STAGE_NUCLEUS_PERSONAL_LINES.NUCLEUS_COVERAGE_FINAL \ngroup by POLICY_NUMBER, POLICY_VERSION, POLICY_ID, ASSET_ID, COVERAGE_ID\nhaving count(*)>1;\n--*/\n\n/* -- BUSINESS KEY VALIDATION QUERY\nselect POLICY_NUMBER, POLICY_VERSION, UNIT_NUMBER, IFNULL(INSURANCE_COVERAGE_CODE, QUOTE_COVERAGE_CODE) as COVERAGE_CODE, COUNT(*) as RowCount\nfrom STAGE_NUCLEUS_PERSONAL_LINES.NUCLEUS_COVERAGE_FINAL \ngroup by POLICY_NUMBER, POLICY_VERSION, UNIT_NUMBER, IFNULL(INSURANCE_COVERAGE_CODE, QUOTE_COVERAGE_CODE)\nhaving count(*)>1;\n--*/\n-------------------------- END COVERAGE FINAL ------------------------------------------------------------------------------\"\"\"\n\ncontext.updateVariable('vScript', vScript)\n\nprint \"Stage views added to script\"\nprint vScript"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"69073":{"id":69073,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-111,"y":49,"width":32,"height":32,"inputConnectorIDs":[69072],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Run View Build"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${vScript}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"69072":{"id":69072,"sourceID":69071,"targetID":69073}},"failureConnectors":{},"unconditionalConnectors":{"69075":{"id":69075,"sourceID":69070,"targetID":69071}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"69068":{"id":69068,"x":-483,"y":-168,"width":400,"height":115,"text":"This base orchestration creates views based on a template saved in S3.\n\nRequired Variables to be set for this orchestration to work:\nvDatabase = Database to create views in\nvRole = Role to use when creating the views\nvSchema = Schema to create the view in\nvWarehouse = Warehouse to use when creating the views","colour":"00ce4f"}},"variables":{"vDatabase":{"definition":{"name":"vDatabase","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"DEV_INSURANCE"},"vRole":{"definition":{"name":"vRole","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"SYSADMIN"},"vSchema":{"definition":{"name":"vSchema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"STAGE_NUCLEUS_PERSONAL_LINES"},"vScript":{"definition":{"name":"vScript","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":"USE ROLE SYSADMIN;"},"vWarehouse":{"definition":{"name":"vWarehouse","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"BUILD_WH"}},"grids":{}},"info":{"name":"Base_Create_Views_Stage","description":"","type":"ORCHESTRATION","tag":"277373b3-8408-44b4-9f1b-80e8f6db73ad"}}