{"job":{"components":{"67884":{"id":67884,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":876,"y":-4,"width":32,"height":32,"inputConnectorIDs":[67890],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_audit_log_fct 0"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_audit_log_fct"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_id"},"2":{"slot":2,"type":"STRING","value":"audit_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"user_id"},"2":{"slot":2,"type":"STRING","value":"user_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"command_type_sh"},"2":{"slot":2,"type":"STRING","value":"command_type_sh"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"specifier_sh"},"2":{"slot":2,"type":"STRING","value":"specifier_sh"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"audit_dtint"},"2":{"slot":2,"type":"STRING","value":"audit_dtint"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"audit_tsepoch"},"2":{"slot":2,"type":"STRING","value":"audit_tsepoch"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"audit_ts"},"2":{"slot":2,"type":"STRING","value":"audit_ts"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"create_ts"},"2":{"slot":2,"type":"STRING","value":"create_ts"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"67885":{"id":67885,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":400,"y":0,"width":32,"height":32,"inputConnectorIDs":[67893,67895],"outputConnectorIDs":[67892],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join 0"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Shape Data"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_internal_user_dm"},"2":{"slot":2,"type":"STRING","value":"u"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"stg\".\"user\" = \"u\".\"name\" AND\n\"u\".\"start_ts\" < \"stg\".\"audit_ts\" AND\n\"u\".\"end_ts\" > \"stg\".\"audit_ts\""},"2":{"slot":2,"type":"STRING","value":"stg_Left_u"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"u.user_id"},"2":{"slot":2,"type":"STRING","value":"user_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"stg.id"},"2":{"slot":2,"type":"STRING","value":"audit_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"stg.specifier_sh"},"2":{"slot":2,"type":"STRING","value":"specifier_sh"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"stg.command_type_sh"},"2":{"slot":2,"type":"STRING","value":"command_type_sh"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"stg.audit_tsepoch"},"2":{"slot":2,"type":"STRING","value":"audit_tsepoch"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"stg.audit_dtint"},"2":{"slot":2,"type":"STRING","value":"audit_dtint"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"stg.audit_ts"},"2":{"slot":2,"type":"STRING","value":"audit_ts"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"stg.create_ts"},"2":{"slot":2,"type":"STRING","value":"create_ts"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"67886":{"id":67886,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":672,"y":0,"width":32,"height":32,"inputConnectorIDs":[67892],"outputConnectorIDs":[67890],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Swap Defaults"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"COALESCE(\"user_id\", -1)"},"2":{"slot":2,"type":"STRING","value":"user_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"67887":{"id":67887,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-80,"y":0,"width":32,"height":32,"inputConnectorIDs":[67894],"outputConnectorIDs":[67897],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter - High Water Mark"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"timestamp"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than"},"4":{"slot":4,"type":"STRING","value":"${max_audit_ts}"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"67888":{"id":67888,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":400,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[67893],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_internal_user_dm"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_internal_user_dm"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"user_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"name"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"start_ts"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"end_ts"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"67889":{"id":67889,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-256,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[67894],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg_mtln_api_audit"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg_mtln_api_audit"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"commandType"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"specifier"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"timestamp"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"user"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"67891":{"id":67891,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":80,"y":0,"width":32,"height":32,"inputConnectorIDs":[67897],"outputConnectorIDs":[67895],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Shape Data"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATEADD(MS, \"timestamp\", '1970-01-01')"},"2":{"slot":2,"type":"STRING","value":"audit_ts"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SHA2(\"specifier\",256)"},"2":{"slot":2,"type":"STRING","value":"specifier_sh"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"SHA2(\"commandType\",256)"},"2":{"slot":2,"type":"STRING","value":"command_type_sh"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"TO_TIMESTAMP_NTZ( '${curr_ts}' )"},"2":{"slot":2,"type":"STRING","value":"create_ts"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"TO_VARCHAR(DATEADD(MS, \"timestamp\", '1970-01-01'), 'YYYYMMDD')\n"},"2":{"slot":2,"type":"STRING","value":"audit_dtint"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"\"timestamp\""},"2":{"slot":2,"type":"STRING","value":"audit_tsepoch"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"67890":{"id":67890,"sourceID":67886,"targetID":67884},"67892":{"id":67892,"sourceID":67885,"targetID":67886},"67893":{"id":67893,"sourceID":67888,"targetID":67885},"67894":{"id":67894,"sourceID":67889,"targetID":67887},"67895":{"id":67895,"sourceID":67891,"targetID":67885},"67897":{"id":67897,"sourceID":67887,"targetID":67891}},"notes":{"67880":{"id":67880,"x":-152,"y":-110,"width":132,"height":170,"text":"Filter staged data less than High Water Mark (Audit Event Timestamp)","colour":"e6e63c"},"67881":{"id":67881,"x":566,"y":-132,"width":205,"height":187,"text":"Swap in Default values for any failed Dimension lookups.","colour":"e6e63c"},"67882":{"id":67882,"x":312,"y":-130,"width":202,"height":348,"text":"User Dimension Lookup - SCD Type 2\nFind the User Dimension row that was Active for the User associated to the Audit Log event when the event occurred.","colour":"e6e63c"},"67883":{"id":67883,"x":20,"y":-121,"width":254,"height":185,"text":"Apply required Data Transformations. \n- Derive Hash keys of dimensions.\n- Parse Unix Timestamp into other formats","colour":"e6e63c"}},"noteConnectors":{},"variables":{"curr_ts":{"definition":{"name":"curr_ts","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"1900-01-01 00:00:00"},"max_audit_ts":{"definition":{"name":"max_audit_ts","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0"}},"grids":{}},"info":{"name":"Matillion Audit Fact - Load","description":"","type":"TRANSFORMATION","tag":"f2eeb73d-cd38-440a-aa43-91981c7788ee"}}