{"job":{"components":{"400251":{"id":400251,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-384,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[400931],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"400308":{"id":400308,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":-16,"y":0,"width":32,"height":32,"inputConnectorIDs":[401734],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[400389],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Convert Log to Grid"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# This script converts\n# THE MESSAGE EXPORT from the RUN DBT COMMAND COMPONENT (jv_dbt_exports_message)\n# to a MATILLION GRID VARIABLE (gv_dbt_tasks)\n\n#CREATE FUNCTION TO CONVERT MULTI-LINE STRING TO LIST\ndef split_lines(s):\n  return s.split('\\n')\n\n#RUN jv_dbt_tests_message THROUGH FUNCTION\nprint(jv_dbt_tests_message)\ndbt_output = split_lines(str(jv_dbt_tests_message))\n\n#LOOP THROUGH LIST OUTPUT AND CREATE NEW LIST WITH PASS/FAIL ENTRIES\ndbt_output_task_list = []\nfor each in dbt_output:\n  if \" of \" in each:\n    dbt_output_task_list.append(each)\n      \nprint(dbt_output_task_list)\n\n#PARSE THROUGH EACH ITEM AND CONVERT EACH PASS/FAIL ENTRY TO DATAPOINTS WITHIN GV\ntotal_task = ''\nnumber_task = ''\ntask_name = ''\nresult = ''\nduration = ''\ngv_list = []\n\nfor item in dbt_output_task_list:\n  if \"OK\" in item:\n    if \"hook\" in item:\n      item_list = []\n      item_parse = item.split(' ')\n      number_task = item_parse[2]\n      item_list.append(number_task)\n      total_task = item_parse[4]\n      item_list.append(total_task)\n      result = item_parse[5]\n      item_list.append(result)\n      task_name = item_parse[7]\n      item_list.append(task_name)\n      duration = item_parse[-1].split(\"'\")[0][:-1]\n      item_list.append(duration)\n      gv_list.append(item_list)\n    else:\n      item_list = []\n      item_parse = item.split(' ')\n      number_task = item_parse[2]\n      item_list.append(number_task)\n      total_task = item_parse[4]\n      item_list.append(total_task)\n      result = item_parse[5]\n      item_list.append(result)\n      task_name = item_parse[10]\n      item_list.append(task_name)\n      duration = item_parse[-1].split(\"'\")[0][:-1]\n      item_list.append(duration)\n      gv_list.append(item_list)\n  elif (\"PASS\") in item:\n    item_list = []\n    item_parse = item.split(' ')\n    number_task = item_parse[2]\n    item_list.append(number_task)\n    total_task = item_parse[4]\n    item_list.append(total_task)\n    result = item_parse[5]\n    item_list.append(result)\n    task_name = item_parse[6]\n    item_list.append(task_name)\n    duration = item_parse[-1].split(\"'\")[0][:-1]\n    item_list.append(duration)\n    gv_list.append(item_list)\n  elif (\"FAIL\") in item:\n    item_list = []\n    item_parse = item.split(' ')\n    number_task = item_parse[2]\n    item_list.append(number_task)\n    total_task = item_parse[4]\n    item_list.append(total_task)\n    result = item_parse[5]\n    item_list.append(result)\n    task_name = item_parse[7]\n    item_list.append(task_name)\n    duration = item_parse[-1].split(\"'\")[0][:-1]\n    item_list.append(duration)\n    gv_list.append(item_list)\n    \ncontext.updateGridVariable('gv_dbt_tasks', gv_list)\n\nprint (context.getGridVariable('gv_dbt_tasks'))\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"400344":{"id":400344,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":144,"y":0,"width":32,"height":32,"inputConnectorIDs":[400389],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Netflix_LogtoTable (1) 0"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Netflix_LogtoTable (1)"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DestinationTable"},"2":{"slot":2,"type":"STRING","value":"${destination_table}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"gv_dbt_tasks"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"task_num"},"2":{"slot":2,"type":"GRID","value":"task_total"},"3":{"slot":3,"type":"GRID","value":"task_name"},"4":{"slot":4,"type":"GRID","value":"task_result"},"5":{"slot":5,"type":"GRID","value":"task_duration"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"gv_dbt_xtasks"},"2":{"slot":2,"type":"STRING","value":"grid"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"400930":{"id":400930,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":-272,"y":0,"width":32,"height":32,"inputConnectorIDs":[400931],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[401723],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Test Script"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"context.updateVariable('dbt_log', '''\n[0m20:18:36  Running with dbt=1.3.1\n[0m20:18:36  Unable to do partial parsing because profile has changed\n[0m20:18:36  Unable to do partial parsing because env vars used in profiles.yml have changed\n[0m20:18:39  [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.\nThere are 1 unused configuration paths:\n- models.my_new_project.example\n\n[0m20:18:39  Found 24 models, 12 tests, 0 snapshots, 0 analyses, 751 macros, 2 operations, 0 seed files, 12 sources, 0 exposures, 0 metrics\n[0m20:18:39  \n[0m20:18:41  \n[0m20:18:41  Running 2 on-run-start hooks\n[0m20:18:41  1 of 2 START hook: my_new_project.on-run-start.0 ............................... [RUN]\n[0m20:18:41  1 of 2 OK hook: my_new_project.on-run-start.0 .................................. [[32mOK[0m in 0.00s]\n[0m20:18:41  2 of 2 START hook: my_new_project.on-run-start.1 ............................... [RUN]\n[0m20:18:41  2 of 2 OK hook: my_new_project.on-run-start.1 .................................. [[32mOK[0m in 0.00s]\n[0m20:18:41  \n[0m20:18:42  Concurrency: 1 threads (target='emerald-target')\n[0m20:18:42  \n[0m20:18:42  1 of 11 START sql incremental model PUBLIC.STG_SEARCH_ANALYSIS ................. [RUN]\n[0m20:18:43  1 of 11 OK created sql incremental model PUBLIC.STG_SEARCH_ANALYSIS ............ [[32mSUCCESS 1[0m in 1.86s]\n[0m20:18:43  2 of 11 START test dbt_expectations_expect_column_to_exist_STG_SEARCH_ANALYSIS_imdbrating  [RUN]\n[0m20:18:44  2 of 11 PASS dbt_expectations_expect_column_to_exist_STG_SEARCH_ANALYSIS_imdbrating  [[32mPASS[0m in 0.75s]\n[0m20:18:44  3 of 11 START test dbt_expectations_expect_column_to_exist_STG_SEARCH_ANALYSIS_watch_priority  [RUN]\n[0m20:18:45  3 of 11 PASS dbt_expectations_expect_column_to_exist_STG_SEARCH_ANALYSIS_watch_priority  [[32mPASS[0m in 0.69s]\n[0m20:18:45  4 of 11 START test dbt_expectations_expect_column_values_to_be_between_STG_SEARCH_ANALYSIS_imdbrating__10  [RUN]\n[0m20:18:46  4 of 11 PASS dbt_expectations_expect_column_values_to_be_between_STG_SEARCH_ANALYSIS_imdbrating__10  [[32mPASS[0m in 0.75s]\n[0m20:18:46  5 of 11 START test dbt_expectations_expect_column_values_to_be_of_type_STG_SEARCH_ANALYSIS_synopsis__VARCHAR  [RUN]\n[0m20:18:46  5 of 11 PASS dbt_expectations_expect_column_values_to_be_of_type_STG_SEARCH_ANALYSIS_synopsis__VARCHAR  [[32mPASS[0m in 0.74s]\n[0m20:18:46  6 of 11 START test dbt_expectations_expect_table_row_count_to_be_between_STG_SEARCH_ANALYSIS_1000  [RUN]\n[0m20:18:47  6 of 11 PASS dbt_expectations_expect_table_row_count_to_be_between_STG_SEARCH_ANALYSIS_1000  [[32mPASS[0m in 0.69s]\n[0m20:18:47  7 of 11 START test not_null_STG_SEARCH_ANALYSIS_imdbrating ..................... [RUN]\n[0m20:18:48  7 of 11 FAIL 2 not_null_STG_SEARCH_ANALYSIS_imdbrating ......................... [[31mFAIL 2[0m in 1.00s]\n[0m20:18:48  8 of 11 START test not_null_STG_SEARCH_ANALYSIS_title .......................... [RUN]\n[0m20:18:49  8 of 11 FAIL 2 not_null_STG_SEARCH_ANALYSIS_title .............................. [[31mFAIL 2[0m in 0.64s]\n[0m20:18:49  9 of 11 START test not_null_STG_SEARCH_ANALYSIS_watch_priority ................. [RUN]\n[0m20:18:49  9 of 11 FAIL 2 not_null_STG_SEARCH_ANALYSIS_watch_priority ..................... [[31mFAIL 2[0m in 0.69s]\n[0m20:18:49  10 of 11 START test not_null_STG_SEARCH_ANALYSIS_year .......................... [RUN]\n[0m20:18:50  10 of 11 FAIL 2 not_null_STG_SEARCH_ANALYSIS_year .............................. [[31mFAIL 2[0m in 0.65s]\n[0m20:18:50  11 of 11 START test unique_STG_SEARCH_ANALYSIS_id .............................. [RUN]\n[0m20:18:51  11 of 11 PASS unique_STG_SEARCH_ANALYSIS_id .................................... [[32mPASS[0m in 0.83s]\n[0m20:18:51  \n[0m20:18:51  Finished running 1 incremental model, 10 tests, 2 hooks in 0 hours 0 minutes and 11.79 seconds (11.79s).\n[0m20:18:51  \n[0m20:18:51  [31mCompleted with 4 errors and 0 warnings:[0m\n[0m20:18:51  \n[0m20:18:51  [31mFailure in test not_null_STG_SEARCH_ANALYSIS_imdbrating (models/netflix_search/schema.yml)[0m\n[0m20:18:51    Got 2 results, configured to fail if != 0\n[0m20:18:51  \n[0m20:18:51    compiled Code at target/compiled/my_new_project/models/netflix_search/schema.yml/not_null_STG_SEARCH_ANALYSIS_imdbrating.sql\n[0m20:18:51  \n[0m20:18:51  [31mFailure in test not_null_STG_SEARCH_ANALYSIS_title (models/netflix_search/schema.yml)[0m\n[0m20:18:51    Got 2 results, configured to fail if != 0\n[0m20:18:51  \n[0m20:18:51    compiled Code at target/compiled/my_new_project/models/netflix_search/schema.yml/not_null_STG_SEARCH_ANALYSIS_title.sql\n[0m20:18:51  \n[0m20:18:51  [31mFailure in test not_null_STG_SEARCH_ANALYSIS_watch_priority (models/netflix_search/schema.yml)[0m\n[0m20:18:51    Got 2 results, configured to fail if != 0\n[0m20:18:51  \n[0m20:18:51    compiled Code at target/compiled/my_new_project/models/netflix_search/schema.yml/not_null_STG_SEARCH_ANALYSIS_watch_priority.sql\n[0m20:18:51  \n[0m20:18:51  [31mFailure in test not_null_STG_SEARCH_ANALYSIS_year (models/netflix_search/schema.yml)[0m\n[0m20:18:51    Got 2 results, configured to fail if != 0\n[0m20:18:51  \n[0m20:18:51    compiled Code at target/compiled/my_new_project/models/netflix_search/schema.yml/not_null_STG_SEARCH_ANALYSIS_year.sql\n[0m20:18:51  \n[0m20:18:51  Done. PASS=7 WARN=0 ERROR=4 SKIP=0 TOTAL=11\n''')"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"401700":{"id":401700,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":-144,"y":0,"width":32,"height":32,"inputConnectorIDs":[401723],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[401734],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jv_user_message_var = 'dbt_log'\nprint(jv_user_message_var)\ncontext.updateVariable('jv_dbt_tests_message', jv_user_message_var)\nprint(jv_dbt_tests_message)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{},"failureConnectors":{},"unconditionalConnectors":{"400389":{"id":400389,"sourceID":400308,"targetID":400344},"400931":{"id":400931,"sourceID":400251,"targetID":400930},"401723":{"id":401723,"sourceID":400930,"targetID":401700},"401734":{"id":401734,"sourceID":401700,"targetID":400308}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"destination_table":{"definition":{"name":"destination_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"jv_dbt_tests_message":{"definition":{"name":"jv_dbt_tests_message","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"jv_user_message_var":{"definition":{"name":"jv_user_message_var","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{"gv_dbt_tasks":{"definition":{"name":"gv_dbt_tasks","scope":"BRANCH","definitions":[{"name":"task_num","type":"TEXT"},{"name":"task_total","type":"TEXT"},{"name":"task_name","type":"TEXT"},{"name":"task_result","type":"TEXT"},{"name":"task_duration","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"dbt Log To Table","description":null,"type":"ORCHESTRATION","tag":"9840bc53-7755-4f7e-9039-acf0350777e3"}}